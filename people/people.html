<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>People</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Oswald:wght@200..700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="./styles.css">
</head>

<body>
    <div class="sec1" id="prev-section"></div>
    <section class="peoplesection"  id="people-section">
        <div class="peopdiv">
            <div class="peopletag">
                <h1>People</h1>
            </div>
            <div class="pcnt">
                <div class="people-cont">
                    <h2>HOME IS WHERE THESE MISFITS ARE</h2>

                </div>
                <div class="peoplecard" id="peoplecard">
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                    <div class="pcard">
                        <div class="image-overlay">
                            <div class="layer"></div>
                            <img src="./assests/images/image 85.png" alt="">
                        </div>
                        <h1>Jolene Mok</h1>
                        <h2>Senior Producer</h2>
                    </div>
                </div>
            </div>


        </div>
        <div class="scroll-b" id="scroll-id">
            <div class="scroll-bar-track"></div>
            <h1 class="scroll-indicator" id="scroll-indicator">
                [scroll]
            </h1>
        </div>
    </section>
    <div class="sec1" id="next-section"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.10.4/ScrollTrigger.min.js"></script>
    <!-- <script src="./script.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/Draggable.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
    gsap.registerPlugin(ScrollTrigger, Draggable);

    const imagesContainer = document.querySelector('.peoplecard');
    const totalScrollWidth = imagesContainer.scrollWidth - imagesContainer.clientWidth;

    const scrollIndicator = document.querySelector('#scroll-indicator');
    const scrollIndicatorContainer = document.querySelector('.scroll-b');
    const maxScrollIndicatorX = scrollIndicatorContainer.offsetWidth - scrollIndicator.offsetWidth;

    let isPinned = false; // To track the pin state of the section
    let currentVerticalScroll = window.scrollY; // Store current vertical scroll position

    // Function to create ScrollTrigger and enable re-initialization on re-entry
    function createScrollAnimation() {
        return gsap.to(imagesContainer, {
            x: -totalScrollWidth,
            ease: "none",
            scrollTrigger: {
                id: "imageScroll",
                trigger: "#people-section",
                start: "top top",
                end: () => `+=${totalScrollWidth}`,
                scrub: 1,
                pin: true,
                anticipatePin: 1,
                markers: false,
                onEnter: () => {
                    // Reset scroll indicator to start on re-entry
                    gsap.set(scrollIndicator, { x: 0 });
                },
                onUpdate: (self) => {
                    const progressRatio = self.progress;
                    const indicatorPosition = Math.min(maxScrollIndicatorX, progressRatio * maxScrollIndicatorX);

                    // Smoothly sync the scroll indicator with scrolling
                    gsap.to(scrollIndicator, { x: indicatorPosition, duration: 0.2, ease: "power1.out" });
                },
                onToggle: (self) => {
                    // Track whether the section is pinned or not
                    isPinned = self.isActive;

                    // Enable or disable the draggable functionality based on pin state
                    if (isPinned) {
                        Draggable.get(scrollIndicator).enable();
                    } else {
                        Draggable.get(scrollIndicator).disable();
                    }
                },
                onLeaveBack: () => {
                    // Ensure the section re-pins on re-entry
                    ScrollTrigger.getById("imageScroll").refresh();
                },
            }
        });
    }

    // Initialize ScrollTrigger animation
    createScrollAnimation();

    // Make the scroll indicator draggable and ensure it syncs horizontal animation
    Draggable.create(scrollIndicator, {
        type: "x",
        bounds: scrollIndicatorContainer,
        onDrag: function () {
            const dragProgress = this.x / maxScrollIndicatorX;

            // Move imagesContainer directly based on drag position
            gsap.to(imagesContainer, {
                x: -dragProgress * totalScrollWidth,
                overwrite: "auto",
                ease: "power1.out",
                duration: 0.3
            });

            // Update the ScrollTrigger progress to match the drag position
            const imageScrollTrigger = ScrollTrigger.getById("imageScroll");
            if (imageScrollTrigger) {
                imageScrollTrigger.scroll(dragProgress * imageScrollTrigger.end);
            }
        },
        onDragEnd: function () {
            const imageScrollTrigger = ScrollTrigger.getById("imageScroll");

            // Release the section pin if at the start or end of the scroll
            if (this.x === 0 || this.x === maxScrollIndicatorX) {
                imageScrollTrigger.disable();
            } else {
                // Refresh ScrollTrigger if in middle to keep the pin
                imageScrollTrigger.enable();
            }

            // Align ScrollTrigger progress with drag position after dragging ends
            ScrollTrigger.refresh();
        }
    });

    // Prevent vertical scroll reset on drag by storing vertical scroll position
    window.addEventListener('scroll', () => {
        // Capture the vertical scroll position
        currentVerticalScroll = window.scrollY;
    });

    // Function to maintain vertical scroll position
    function maintainVerticalScrollPosition() {
        window.scrollTo(0, currentVerticalScroll);
    }

    // Keep the vertical scroll position intact while dragging the scroll indicator
    Draggable.create(scrollIndicator, {
        type: "x",
        bounds: scrollIndicatorContainer,
        onDrag: function () {
            maintainVerticalScrollPosition(); // Keep vertical scroll from changing

            const dragProgress = this.x / maxScrollIndicatorX;

            // Move imagesContainer directly based on drag position
            gsap.to(imagesContainer, {
                x: -dragProgress * totalScrollWidth,
                overwrite: "auto",
                ease: "power1.out",
                duration: 0.3
            });

            // Update the ScrollTrigger progress to match the drag position
            const imageScrollTrigger = ScrollTrigger.getById("imageScroll");
            if (imageScrollTrigger) {
                imageScrollTrigger.scroll(dragProgress * imageScrollTrigger.end);
            }
        }
    });
});

    </script>
    
</body>

</html>